Pulls in election data, politicians
Done: regress social media on gender spike
TODO:
  * Regress elections on social media:gender interaction
    * Subset to most recent elections
    * Figure out who won who lost

```{r}
library(dplyr)
library(ggplot2)
```

## Pull in election data
[Source](https://electionlab.mit.edu/data)
```{r}
UsSenateElections <- read.csv("elections/UsSenate/1976-2016-senate.csv", as.is = T)
UsHouseElections <- read.csv("elections/UsHouse/1976-2016-house.csv", as.is = T)
StateOfficeElections <- read.csv("elections/StateOffice/stateoffices2016.csv", as.is = T)
```

* Going forward, $office gives US Senate, etc.
* $candidate gives who won, etc.
```{r}
colnames(StateOfficeElections)
colnames(UsSenateElections) == colnames(UsHouseElections)
colnames(StateOfficeElections)[!(colnames(StateOfficeElections) %in% colnames(UsSenateElections))]
table(StateOfficeElections$mode)
table(UsSenateElections$office)
```

```{r}
ElectionsDF <- plyr::rbind.fill(UsSenateElections, UsHouseElections, StateOfficeElections)
nrow(ElectionsDF)
head(rev(sort(table(ElectionsDF$office))))
```

## Get candidate first and last name
```{r}
ElectionsDF$candidate <- trimws(ElectionsDF$candidate)
length(which(ElectionsDF$candidate == ""))
ElectionsDF <- ElectionsDF[ElectionsDF$candidate != "",]

ElectionsDF$first_name <- gsub("((^ )*) .*", "\\1", ElectionsDF$candidate)
ElectionsDF$last_name <- gsub(".* ((^ )*)", "\\1", ElectionsDF$candidate)

head(ElectionsDF %>% select(first_name, last_name))
```

```{r}
table(ElectionsDF$state)
```

## Merge with Frances' metadata
```{r}
USPoliticiansMetaDF <- read.csv("metadata/Copy of US politicians_md.csv", as.is = T)

# Take only unique - revisit
USPoliticiansMetaDF <- USPoliticiansMetaDF %>%
  group_by(first_name, last_name) %>%
  filter(row_number()==1)
USPoliticiansMetaDF

USPoliticiansMetaDF$officeBuilding <- USPoliticiansMetaDF$office
USPoliticiansMetaDF <- USPoliticiansMetaDF %>% select(-c(office))

USPoliticiansMetaDF$stateAbb <- USPoliticiansMetaDF$state
USPoliticiansMetaDF <- USPoliticiansMetaDF %>% select(-c(state))

table(USPoliticiansMetaDF$state)
stateConversion <- data.frame("StateName"=as.character(state.name), "abb"=as.character(state.abb), stringsAsFactors = F)
stateConversion
```

```{r}
USPoliticiansMetaDF <- USPoliticiansMetaDF %>% inner_join(stateConversion, by=c("stateAbb" = "abb"))
```

## 100 senators, 447 house members
```{r}
MetadataWElections <- ElectionsDF %>% inner_join(USPoliticiansMetaDF, by=c("first_name", "last_name", "state"="StateName"))

countIndivsElections <- MetadataWElections %>% group_by(first_name, last_name, office) %>% dplyr::summarise(n = n())

sum(countIndivsElections[countIndivsElections$office=="US Senate","n"])
nrow(countIndivsElections[countIndivsElections$office=="US Senate",])

sum(countIndivsElections[countIndivsElections$office=="US House","n"])
nrow(countIndivsElections[countIndivsElections$office=="US House",])
```

```{r}
x <- MetadataWElections %>% arrange(first_name, last_name, state) %>% select(first_name, last_name, state, in_office)
table(x$in_office)
```

## What am I even getting from this data collected by Frances??
* Different levels of office not as interesting as who won/lost based on social media content.
* Just guess at their genders from their first name.
```{r}
colnames(USPoliticiansMetaDF)
USPoliticiansMetaDF %>% select(gender)
```


```{r}
table(MetadataWElections$stage)
```

```{r}
MetadataWElections
```







## Scrap
```{r}
library(tidyr)
metaDataWHandTaggedTweets %>% separate(audience)
```

```{r}
library(reshape2)
dcast(metaDataWHandTaggedTweets, audience)
```

```{r}
df <- data.frame(cbind(1:10, 2:11, 1:3))
colnames(df) <- c("ID","DATE","SECTOR")
df <- data.frame(df, value=TRUE)
df
```

```{r}
reshape(df, idvar=c("ID","DATE"), timevar="SECTOR", direction="wide")
```

```{r}
# reshape(metaDataWHandTaggedTweets, idvar=c("id.x", "first_name", "last_name"), timevar = "audience", direction = "wide")
```

```{r}
metaDataWHandTaggedTweets
```








## SCRAP
```{r}
genderBreakdown <-metaDataWHandTaggedTweets %>% group_by(gender) %>% summarise(n=n())
```


```{r}
table(metaDataWHandTaggedTweets[metaDataWHandTaggedTweets$gender=="M","audience"])
table(metaDataWHandTaggedTweets[metaDataWHandTaggedTweets$gender=="F","audience"])
```











